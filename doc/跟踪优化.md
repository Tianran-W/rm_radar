# 跟踪优化

*2024/4/13 by zmsbruce*

## 为什么要优化

去年的跟踪方法是放在检测之后定位之前，使用了 DeepSORT 进行检测框的跟踪。从实际效果上看，这是一个比较鸡肋的做法：

* 定位中的二维检测框实际上并不需要特别精确，有时为了搜寻更多的点反而需要扩大搜索范围，即放大搜索框，这导致了对二维检测框进行卡尔曼滤波并没有多大的意义；
* 然而目标跟踪能够对误识别进行有效的抑制，即当某一帧或几帧对一个机器人的识别出现了错误时，DeepSORT 能够根据检测框和历史特征进行正确的匹配，并进一步修改其为正确的类别；

虽然使用 DeepSORT 进行目标跟踪并没有完全利用其功能，但仅仅使用其当作类别的稳定器也未尝不可。真正导致需要优化的原因是**定位的跳变**，即在检测框包含场地边缘时，定位会受到噪点的干扰而导致其不准确（具体可以查看[此文档](./聚类优化.md)）。

为了解决上述问题，同时使得跟踪算法得到更完全的利用，我们将跟踪转移到定位之后，并不再套用 DeepSORT 算法，而是利用其思想，构造出针对定位后的三维坐标的跟踪算法。

## 滤波器的选择

辛格模型（Singer model）是一种用于描述目标在雷达或追踪系统中的加速度变化的数学模型。这种模型特别适用于处理目标的机动性，例如在空中或海上的飞机、导弹和船只等，它们的加速度不是恒定的，而是随时间变化的。辛格模型通过引入一个随机过程来模拟这种加速度变化，从而提高了跟踪滤波器在面对机动目标时的性能。

### 辛格模型的基本形式

在辛格模型中，目标的加速度被建模为一阶马尔科夫过程，即具有指数相关的随机过程。该模型的数学表示如下：

设 \( a(t) \) 为时间 \( t \) 时的加速度，辛格模型假设 \( a(t) \) 遵循以下随机微分方程：

\[ \frac{da(t)}{dt} = -\frac{1}{\tau} a(t) + \sigma \sqrt{\frac{2}{\tau}} w(t) \]

其中：
- \( \tau \) 是相关时间，表示加速度保持相关的时间长度。
- \( \sigma \) 是加速度过程的标准差，表示加速度的变化程度。
- \( w(t) \) 是标准白噪声过程。

### 模型解释

在辛格模型中，第一项 \( -\frac{1}{\tau} a(t) \) 表示加速度会自然地衰减到零，而这种衰减是以 \( \tau \) 为时间常数的指数衰减过程。第二项 \( \sigma \sqrt{\frac{2}{\tau}} w(t) \) 表示新的随机加速度被加入到系统中，其中 \( \sigma \) 控制加速度变化的振幅，\( \sqrt{\frac{2}{\tau}} \) 确保整个过程的功率谱密度保持恒定。

### 优点

* 模型适合：辛格模型用于描述目标在雷达或追踪系统中的加速度变化，正好符合我们的需求；
* 参数少：只需要调整 \( \sigma \) 和 \( \tau \) 这两个参数；

## 匹配算法

Auction 算法是一种用于解决分配问题的有效算法，特别是在求解带权重的二分匹配问题中表现突出。这种算法以其竞拍（或拍卖）的过程命名，其中买家（或对象）和卖家（或任务）通过一系列迭代竞标来达到最优匹配。Auction 算法由 Dimitri Bertsekas 在 1980 年代提出，它是一种快速的离散优化方法，尤其适用于大规模问题。

### 基本概念

在典型的分配问题中，我们有一组买家和一组卖家，每个买家对每个卖家有一个特定的价值或偏好。目标是找到买家和卖家之间的最优匹配，使得总体价值最大化或总成本最小化。

### 算法步骤

Auction 算法的核心思想是模拟一个拍卖过程，其中买家对卖家进行出价。算法的基本步骤包括：

1. **初始化**：
   - 每个买家开始时都没有匹配的卖家。
   - 每个卖家设置一个价格，初始价格可以是0或其他基线值。

2. **竞拍阶段**：
   - 每个未匹配的买家考虑所有卖家，并基于当前的价格和自己对卖家的评估（价值减去价格）选择最合算的卖家进行出价。
   - 买家会出一个比当前价格稍高的价格，这个增幅称为“出价增量”。

3. **分配阶段**：
   - 卖家会收到来自一个或多个买家的出价。如果有多个出价，卖家会选择出价最高的买家，并更新自己的价格为这个出价。
   - 被选中的买家与该卖家匹配，之前与该卖家匹配的买家（如果有的话）变为未匹配状态。

4. **终止条件**：
   - 当所有买家都成功匹配后，算法结束。
   - 如果有买家未匹配，返回到竞拍阶段。

### 特点和优势

- **效率**：Auction算法特别适合大规模问题，因为它允许并行处理和快速迭代。
- **灵活性**：可以调整出价策略和增量，优化算法的性能。
- **实现简单**：算法结构清晰，易于实现。

## 整体算法

整体算法与 SORT 近似：

1. **检测**：在每一帧中，首先检测出每个机器人的三维位置坐标和类别；

2. **预测**：对于已经在跟踪中的每个目标，使用卡尔曼滤波器预测其在当前帧中的位置；

3. **数据关联**：使用当前帧中的检测结果和预测的跟踪位置来进行数据关联。关联评分通过计算位置和类别按照一定比例加权得到。

4. **更新**：根据匹配结果，更新每个跟踪目标的状态。如果一个跟踪目标在当前帧有匹配的检测结果，则卡尔曼滤波器使用这个新的检测数据来校正目标的位置和类别。

5. **创建和删除轨迹**：对于那些在当前帧中被检测到但没有与任何现有跟踪匹配的检测框，初始化新的跟踪器。如果一个跟踪目标在多个连续帧中没有匹配的检测结果，认为该目标已经丢失，因此将其从跟踪列表中删除。